{% extends 'tools/modal.html' %}
{% block title %}{{ title }}{% endblock %}

    {% block form %}
    <form method="POST" id="modal_form" action="{{ action_url }}">
        {% csrf_token %}
        {{ form }}
        {% if step %}
        <input type="submit" name="choose_button" value="Выберите персонажа">
        <input type="hidden" name="choose_char" value="true">
        {% else %}
        <input type="hidden" name="char" value="{{char.pk}}">
        {% for vform in visforms %}
            {{ vform.instance.player.get_char }}
            {{ vform }}
        {% endfor %}
        {% endif %}
    </form>
    {% endblock %}

{% block script %}
<script>
    $("#modal_form").submit(function(e) {
    var url = $("#modal_form").attr('action');
    e.preventDefault(); // avoid to execute the actual submit of the form.
    $.ajax({
           type: "POST",
           url: url,
           data: $("#modal_form").serialize(), // serializes the form's elements.
           success: function(data)
           {
               if (data.reload) {
                     $('#'+data.id).load(data.url)
                    $('#modal_close').click()
               } else {
                    $('#inner_content').parent().html(data)
               }
           }
         });


    });
    $("#modal_save").on("click", function(){
        $("#modal_form").submit()
    });
    {% if deletable %}
    $("#modal_delete").on("click", function(){
        $("#delete_flag").attr("value", true)
        $("#modal_form").submit()
    });
    {% endif %}
</script>
{% endblock %}